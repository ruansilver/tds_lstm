# EMGåˆ°å§¿æ€é¢„æµ‹ - æ·±åº¦å­¦ä¹ è®­ç»ƒç³»ç»Ÿ

> åŸºäºTDS-LSTMçš„EMGä¿¡å·åˆ°äººä½“å§¿æ€é¢„æµ‹çš„æ·±åº¦å­¦ä¹ é¡¹ç›®

## ğŸ“ é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®å®ç°äº†ä»è‚Œç”µä¿¡å·(EMG)åˆ°äººä½“å§¿æ€é¢„æµ‹çš„æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒç³»ç»Ÿã€‚é‡‡ç”¨Time-Delay Stabilized LSTM (TDS-LSTM)æ¶æ„ï¼Œæ”¯æŒç«¯åˆ°ç«¯çš„è®­ç»ƒå’Œè¯„ä¼°æµç¨‹ã€‚

### âœ¨ ä¸»è¦ç‰¹æ€§

- ğŸ¯ **ä¸€é”®è®­ç»ƒ**: é€šè¿‡`python main.py`å³å¯å®Œæˆå®Œæ•´çš„è®­ç»ƒæµç¨‹
- âš™ï¸ **é…ç½®é©±åŠ¨**: æ‰€æœ‰è¶…å‚æ•°é€šè¿‡YAMLé…ç½®æ–‡ä»¶ç®¡ç†ï¼Œæ— éœ€å‘½ä»¤è¡Œå‚æ•°
- ğŸ“Š **TensorBoardé›†æˆ**: å®æ—¶ç›‘æ§è®­ç»ƒè¿‡ç¨‹å’Œæ¨¡å‹æ€§èƒ½
- ğŸ”§ **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„é¡¹ç›®ç»“æ„ï¼Œä¾¿äºæ‰©å±•å’Œç»´æŠ¤
- ğŸ“ˆ **è‡ªåŠ¨æŠ¥å‘Š**: è‡ªåŠ¨ç”Ÿæˆå®éªŒæŠ¥å‘Šå’Œå¯è§†åŒ–ç»“æœ
- ğŸš€ **å¤šé…ç½®æ”¯æŒ**: å†…ç½®å¿«é€Ÿæ¼”ç¤ºã€æ ‡å‡†è®­ç»ƒã€é«˜æ€§èƒ½é…ç½®

## ğŸ“ é¡¹ç›®ç»“æ„

```
mytrain/
â”œâ”€â”€ configs/              # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ default.yaml     # é»˜è®¤é…ç½®ï¼ˆ50è½®è®­ç»ƒï¼‰
â”‚   â”œâ”€â”€ quick_demo.yaml  # å¿«é€Ÿæ¼”ç¤ºï¼ˆ10è½®è®­ç»ƒï¼‰
â”‚   â””â”€â”€ high_performance.yaml # é«˜æ€§èƒ½é…ç½®ï¼ˆ200è½®è®­ç»ƒï¼‰
â”œâ”€â”€ data/                # æ•°æ®å¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ dataset.py       # æ•°æ®é›†å®šä¹‰
â”‚   â””â”€â”€ dataloader.py    # æ•°æ®åŠ è½½å™¨
â”œâ”€â”€ models/              # æ¨¡å‹å®šä¹‰æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ model_factory.py # æ¨¡å‹å·¥å‚ï¼ˆæ”¯æŒåŠ¨æ€æ³¨å†Œï¼‰
â”‚   â””â”€â”€ tds_lstm_model.py # TDS-LSTMæ¨¡å‹å®ç°
â”œâ”€â”€ trainers/            # è®­ç»ƒå™¨æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ trainer.py       # ä¸»è®­ç»ƒå™¨
â”‚   â””â”€â”€ evaluator.py     # è¯„ä¼°å™¨
â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ checkpoint.py    # æ£€æŸ¥ç‚¹ç®¡ç†
â”‚   â”œâ”€â”€ early_stopping.py # æ—©åœæœºåˆ¶
â”‚   â”œâ”€â”€ logging_utils.py # æ—¥å¿—å·¥å…·
â”‚   â”œâ”€â”€ metrics.py       # è¯„ä¼°æŒ‡æ ‡
â”‚   â””â”€â”€ visualization.py # å¯è§†åŒ–å·¥å…·
â”œâ”€â”€ logs/                # è®­ç»ƒæ—¥å¿—è¾“å‡º
â”œâ”€â”€ checkpoints/         # æ¨¡å‹æ£€æŸ¥ç‚¹
â”œâ”€â”€ main.py              # ç»Ÿä¸€ä¸»å…¥å£æ–‡ä»¶ â­
â”œâ”€â”€ config.py            # é…ç½®åŠ è½½å™¨ â­
â”œâ”€â”€ requirements.txt     # ä¾èµ–æ¸…å•
â””â”€â”€ README.md           # é¡¹ç›®è¯´æ˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†é¡¹ç›®
git clone <your-repo-url>
cd mytrain

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# éªŒè¯PyTorchå®‰è£…
python -c "import torch; print(f'PyTorchç‰ˆæœ¬: {torch.__version__}')"
```

### 2. æ•°æ®å‡†å¤‡

ç¡®ä¿æ‚¨çš„æ•°æ®é›†è·¯å¾„æ­£ç¡®è®¾ç½®åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼š

```yaml
# configs/default.yaml
data:
  dataset_path: "D:/Dataset/emg2pose_dataset_mini"  # ä¿®æ”¹ä¸ºæ‚¨çš„æ•°æ®é›†è·¯å¾„
  emg_channels: 16          # EMGé€šé“æ•°
  joint_angles_channels: 20 # å…³èŠ‚è§’åº¦é€šé“æ•°
  window_size: 500         # æ—¶é—´çª—å£å¤§å°
```

### 3. ä¸€é”®è®­ç»ƒ

ç¼–è¾‘`main.py`é€‰æ‹©é…ç½®ï¼Œç„¶åè¿è¡Œï¼š

```python
# main.py ä¸­ä¿®æ”¹é…ç½®é€‰æ‹©
SELECTED_CONFIG = 'default'  # å¯é€‰: 'quick_demo', 'default', 'high_performance'

# è¿è¡Œè®­ç»ƒ
python main.py
```

### 4. æŸ¥çœ‹ç»“æœ

è®­ç»ƒå®Œæˆåï¼Œæ£€æŸ¥è¾“å‡ºç›®å½•ï¼š

```
logs/default_20241014_153000/
â”œâ”€â”€ training_20241014_153000.log        # è®­ç»ƒæ—¥å¿—
â”œâ”€â”€ config_20241014_153000.yaml         # é…ç½®å¿«ç…§
â”œâ”€â”€ models/
â”‚   â””â”€â”€ best_model_20241014_153000.pth  # æœ€ä½³æ¨¡å‹
â”œâ”€â”€ visualizations/
â”‚   â””â”€â”€ training_history.png            # è®­ç»ƒæ›²çº¿
â””â”€â”€ experiment_report_20241014_153000.md # å®éªŒæŠ¥å‘Š
```

### 5. å¯åŠ¨TensorBoard

```bash
tensorboard --logdir=logs
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:6006
```

## âš™ï¸ é…ç½®è¯´æ˜

### å¯ç”¨é…ç½®æ–‡ä»¶

| é…ç½®åç§° | æ–‡ä»¶ | æè¿° | è®­ç»ƒè½®æ•° | é€‚ç”¨åœºæ™¯ |
|---------|------|-----|---------|----------|
| `quick_demo` | `configs/quick_demo.yaml` | å¿«é€Ÿæ¼”ç¤ºé…ç½® | 10è½® | æµ‹è¯•ä»£ç ã€å¿«é€ŸéªŒè¯ |
| `default` | `configs/default.yaml` | æ ‡å‡†é…ç½® | 50è½® | ä¸€èˆ¬å®éªŒã€è®ºæ–‡å¤ç° |
| `high_performance` | `configs/high_performance.yaml` | é«˜æ€§èƒ½é…ç½® | 200è½® | è¿½æ±‚æœ€ä½³æ€§èƒ½ |

### é…ç½®æ–‡ä»¶ç»“æ„

```yaml
# æ•°æ®é…ç½®
data:
  dataset_path: "D:/Dataset/emg2pose_dataset_mini"
  emg_channels: 16
  joint_angles_channels: 20
  window_size: 500
  split_ratio: [0.7, 0.15, 0.15]  # [è®­ç»ƒ, éªŒè¯, æµ‹è¯•]

# æ¨¡å‹é…ç½®
model:
  input_size: 16           # è¾“å…¥ç»´åº¦ï¼ˆEMGé€šé“æ•°ï¼‰
  output_size: 20          # è¾“å‡ºç»´åº¦ï¼ˆå…³èŠ‚æ•°ï¼‰
  encoder_features: 64     # TDSç¼–ç å™¨ç‰¹å¾ç»´åº¦
  decoder_hidden: 64       # LSTMè§£ç å™¨éšè—å±‚å¤§å°
  decoder_layers: 2        # LSTMè§£ç å™¨å±‚æ•°
  dropout: 0.2            # Dropoutç‡

# è®­ç»ƒé…ç½®
training:
  num_epochs: 50          # è®­ç»ƒè½®æ•°
  batch_size: 32          # æ‰¹æ¬¡å¤§å°
  learning_rate: 0.001    # å­¦ä¹ ç‡
  optimizer: "adam"       # ä¼˜åŒ–å™¨: adam, adamw, sgd
  scheduler: "step"       # è°ƒåº¦å™¨: step, cosine, plateau
  early_stopping: true    # æ—©åœæœºåˆ¶
  device: "auto"          # è®¾å¤‡: auto, cuda, cpu

# æ—¥å¿—é…ç½®
logging:
  checkpoint_dir: "checkpoints"
  log_dir: "logs"
  save_every: 5           # æ¯Nè½®ä¿å­˜æ£€æŸ¥ç‚¹
  save_best_only: true    # åªä¿å­˜æœ€ä½³æ¨¡å‹
```

## ğŸ”§ é«˜çº§ä½¿ç”¨

### è‡ªå®šä¹‰é…ç½®

1. å¤åˆ¶ç°æœ‰é…ç½®æ–‡ä»¶ï¼š
```bash
cp configs/default.yaml configs/my_config.yaml
```

2. ä¿®æ”¹å‚æ•°ï¼š
```yaml
# configs/my_config.yaml
training:
  num_epochs: 100
  batch_size: 64
  learning_rate: 0.0005
```

3. æ›´æ–°`main.py`ï¼š
```python
SELECTED_CONFIG = 'my_config'
```

### æ·»åŠ æ–°æ¨¡å‹

```python
# åœ¨models/ç›®å½•ä¸‹åˆ›å»ºæ–°æ¨¡å‹æ–‡ä»¶
# models/my_model.py
class MyModel(nn.Module):
    def __init__(self, input_size, output_size, hidden_size=128):
        # æ¨¡å‹å®šä¹‰
        pass

# åœ¨models/__init__.pyä¸­æ³¨å†Œ
from models.model_factory import register_model
from .my_model import MyModel

register_model('my_model', MyModel, {
    'input_size': 16,
    'output_size': 20,
    'hidden_size': 128
})
```

### è¿è¡Œæ¨¡å¼

ä¿®æ”¹`main.py`ä¸­çš„`RUN_MODE`å˜é‡ï¼š

```python
RUN_MODE = 'full'     # å®Œæ•´æµç¨‹ï¼šè®­ç»ƒ + éªŒè¯ + æµ‹è¯•
# RUN_MODE = 'train'  # ä»…è®­ç»ƒå’ŒéªŒè¯
```

## ğŸ“Š ç›‘æ§å’Œå¯è§†åŒ–

### TensorBoardç›‘æ§

å¯åŠ¨TensorBoardæŸ¥çœ‹å®æ—¶è®­ç»ƒè¿›åº¦ï¼š

```bash
tensorboard --logdir=logs
```

å¯ä»¥ç›‘æ§ï¼š
- è®­ç»ƒå’ŒéªŒè¯æŸå¤±æ›²çº¿
- å­¦ä¹ ç‡å˜åŒ–
- å„é¡¹è¯„ä¼°æŒ‡æ ‡
- æ¨¡å‹ç»“æ„å›¾

### å®éªŒæŠ¥å‘Š

æ¯æ¬¡è®­ç»ƒåä¼šè‡ªåŠ¨ç”ŸæˆMarkdownæ ¼å¼çš„å®éªŒæŠ¥å‘Šï¼ŒåŒ…å«ï¼š
- å®éªŒé…ç½®ä¿¡æ¯
- è®­ç»ƒç»“æœç»Ÿè®¡
- æ¨¡å‹æ€§èƒ½æŒ‡æ ‡
- ç”Ÿæˆæ–‡ä»¶æ¸…å•

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### ä»£ç é£æ ¼

- éµå¾ªç§‘ç ”ä»£ç è§„èŒƒï¼šç®€æ´æ¸…æ™°ï¼Œé‡ç‚¹å…³æ³¨å¯è¯»æ€§
- ä½¿ç”¨ç±»å‹æç¤ºå’Œè¯¦ç»†çš„docstring
- æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºæ‰©å±•å’Œç»´æŠ¤

### æ‰©å±•å»ºè®®

1. **æ·»åŠ æ–°æŸå¤±å‡½æ•°**ï¼šåœ¨`trainers/trainer.py`ä¸­ä¿®æ”¹æŸå¤±è®¡ç®—
2. **å¢åŠ è¯„ä¼°æŒ‡æ ‡**ï¼šåœ¨`utils/metrics.py`ä¸­æ·»åŠ æ–°æŒ‡æ ‡
3. **è‡ªå®šä¹‰æ•°æ®é¢„å¤„ç†**ï¼šä¿®æ”¹`data/dataset.py`
4. **é›†æˆå…¶ä»–ä¼˜åŒ–å™¨**ï¼šåœ¨`trainers/trainer.py`ä¸­æ‰©å±•ä¼˜åŒ–å™¨é€‰é¡¹

## ğŸ“š æŠ€æœ¯ç»†èŠ‚

### TDS-LSTMæ¶æ„

Time-Delay Stabilized LSTMç»“åˆäº†ï¼š
- **æ—¶é—´å»¶è¿Ÿå·ç§¯ç¼–ç å™¨**ï¼šæå–EMGä¿¡å·ç‰¹å¾
- **LSTMè§£ç å™¨**ï¼šåºåˆ—åˆ°åºåˆ—æ˜ å°„
- **æ®‹å·®è¿æ¥**ï¼šæå‡è®­ç»ƒç¨³å®šæ€§

### æ•°æ®æµç¨‹

1. **æ•°æ®åŠ è½½**ï¼šHDF5æ ¼å¼ï¼Œæ”¯æŒå¤§è§„æ¨¡æ•°æ®é›†
2. **é¢„å¤„ç†**ï¼šæ»‘åŠ¨çª—å£åˆ†å‰²ï¼Œå¯é€‰æ ‡å‡†åŒ–
3. **æ‰¹å¤„ç†**ï¼šåŠ¨æ€æ‰¹å¤„ç†ï¼Œæ”¯æŒGPUåŠ é€Ÿ
4. **è¯„ä¼°**ï¼šå¤šæŒ‡æ ‡è¯„ä¼°ï¼ˆMSE, MAE, RÂ²ç­‰ï¼‰

## ğŸ› å¸¸è§é—®é¢˜

### Q: CUDAå†…å­˜ä¸è¶³æ€ä¹ˆåŠï¼Ÿ
A: å‡å°`batch_size`æˆ–ä½¿ç”¨`cpu`è®¾å¤‡ï¼š
```yaml
training:
  batch_size: 16    # å‡å°æ‰¹æ¬¡å¤§å°
  device: "cpu"     # æˆ–ä½¿ç”¨CPUè®­ç»ƒ
```

### Q: å¦‚ä½•ä½¿ç”¨è‡ªå·±çš„æ•°æ®é›†ï¼Ÿ
A: ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®è·¯å¾„å’Œæ ¼å¼ï¼š
```yaml
data:
  dataset_path: "your/dataset/path"
  emg_channels: 8      # æ ¹æ®å®é™…é€šé“æ•°ä¿®æ”¹
  joint_angles_channels: 15
```

### Q: è®­ç»ƒä¸­æ–­å¦‚ä½•æ¢å¤ï¼Ÿ
A: æ£€æŸ¥ç‚¹ä¼šè‡ªåŠ¨ä¿å­˜ï¼Œå¯ä»¥ä»æœ€åçš„æ£€æŸ¥ç‚¹ç»§ç»­ï¼š
```python
# åœ¨trainer.pyä¸­åŠ è½½æ£€æŸ¥ç‚¹é€»è¾‘å·²å®ç°
# ä¼šè‡ªåŠ¨ä»æœ€ä½³æ¨¡å‹ç»§ç»­è®­ç»ƒ
```

### Q: å¦‚ä½•è°ƒè¯•æ¨¡å‹ï¼Ÿ
A: ä½¿ç”¨å¿«é€Ÿæ¼”ç¤ºé…ç½®è¿›è¡Œè°ƒè¯•ï¼š
```python
SELECTED_CONFIG = 'quick_demo'  # å¿«é€Ÿè®­ç»ƒ10è½®
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ï¼Œè¯¦è§LICENSEæ–‡ä»¶ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

---

**äº«å—æ‚¨çš„EMGåˆ°å§¿æ€é¢„æµ‹ç ”ç©¶ä¹‹æ—…ï¼** ğŸš€âœ¨




