# 低内存配置 - 适合服务器或内存受限环境
# 使用小batch size + 梯度累积来模拟大batch效果

# 数据配置
data:
  dataset_path: "D:/Dataset/emg2pose_dataset_mini"
  hdf5_group: "emg2pose"
  table_name: "timeseries"
  stride: 2                                        # 增加步长，减少样本数
  
  emg_channels: 16
  joint_angles_channels: 20
  window_size: 500
  
  split_ratio: [0.7, 0.15, 0.15]
  normalize: false
  shuffle: true
  
  # 内存优化配置
  max_samples_for_normalize: 5000                  # 🔴 更少的采样数（节省内存）
  chunk_cache_size: 33554432                       # 🔴 更小的cache（32MB）

# 模型配置 - 中等大小
model:
  input_size: 16
  output_size: 20
  dropout: 0.1
  
  # TDS编码器 - 2个stage，适中配置
  tds_stages:
    - in_conv_kernel: 5
      in_conv_stride: 2
      num_blocks: 2
      channels: 8
      feature_width: 4
      kernel_width: 21
    - in_conv_kernel: 5
      in_conv_stride: 2
      num_blocks: 2
      channels: 8
      feature_width: 8
      kernel_width: 11
  
  # LSTM解码器 - 适中配置
  decoder_type: "sequential_lstm"
  decoder_hidden_size: 128
  decoder_num_layers: 2
  decoder_state_condition: true
  
  predict_velocity: false
  rollout_freq: 50
  original_sampling_rate: 2000

# 训练配置 - 低内存优化
training:
  num_epochs: 100
  batch_size: 16                                   # 🔴 减小batch size（从64降到16）
  learning_rate: 0.0005
  weight_decay: 0.01
  
  optimizer: "adamw"
  scheduler: "cosine"
  
  loss_type: "mse+mae"
  mae_weight: 0.5
  
  warmup_epochs: 5
  gradient_clip_norm: 1.0
  gradient_accumulation_steps: 4                   # 🔴 使用梯度累积模拟batch_size=64
  
  early_stopping: true
  patience: 20
  min_delta: 0.0001
  
  device: "auto"
  num_workers: 2                                   # 🔴 减少工作进程（从4降到2）
  pin_memory: false                                # 🔴 禁用pin_memory节省内存
  
  # 内存优化配置
  persistent_workers: true                         # 保持worker持久化
  prefetch_factor: 1                               # 🔴 减少预取（节省内存）
  compute_metrics_online: true                     # 🔴 必须在线计算（节省内存）

# 日志配置
logging:
  checkpoint_dir: "checkpoints"
  log_dir: "logs"
  save_every: 5
  log_every: 50                                    # 🔴 减少日志频率
  save_best_only: true
  monitor: "val_loss"
  mode: "min"

